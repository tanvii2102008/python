import csv
import datetime

FILE = "expenses.csv"

# Create file if not exists
def create_file():
    try:
        open(FILE, "x").close()
        with open(FILE, "a", newline="") as f:
            writer = csv.writer(f)
            writer.writerow(["Date", "Category", "Amount", "Description"])
    except FileExistsError:
        pass

def add_expense():
    date = input("Enter date (YYYY-MM-DD) or leave blank for today: ")
    if date == "":
        date = str(datetime.date.today())

    category = input("Enter category (Food/Travel/Shopping/Other): ")
    amount = float(input("Enter amount: "))
    description = input("Description: ")

    with open(FILE, "a", newline="") as f:
        writer = csv.writer(f)
        writer.writerow([date, category, amount, description])
    print("\n✓ Expense added successfully!\n")

def view_expenses():
    try:
        with open(FILE, newline="") as f:
            reader = csv.reader(f)
            next(reader)
            print("\n=== All Expenses ===")
            for row in reader:
                print(f"Date: {row[0]}, Category: {row[1]}, Amount: ₹{row[2]}, Note: {row[3]}")
    except:
        print("\n⚠ No data found.\n")

def summary_by_category():
    total = {}
    try:
        with open(FILE, newline="") as f:
            reader = csv.reader(f)
            next(reader)
            for row in reader:
                category = row[1]
                amount = float(row[2])
                total[category] = total.get(category, 0) + amount
        print("\n=== Summary by Category ===")
        for category, amount in total.items():
            print(f"{category}: ₹{amount}")
    except:
        print("\n⚠ No data found.\n")

def summary_by_month():
    monthly = {}
    try:
        with open(FILE, newline="") as f:
            reader = csv.reader(f)
            next(reader)
            for row in reader:
                date = datetime.datetime.strptime(row[0], "%Y-%m-%d")
                key = date.strftime("%Y-%m")
                amount = float(row[2])
                monthly[key] = monthly.get(key, 0) + amount

        print("\n=== Monthly Summary ===")
        for month, amount in monthly.items():
            print(f"{month}: ₹{amount}")
    except:
        print("\n⚠ No data found.\n")

def menu():
    create_file()
    while True:
        print("\n===== Expense Tracker =====")
        print("1. Add Expense")
        print("2. View All Expenses")
        print("3. Summary by Category")
        print("4. Monthly Summary")
        print("5. Exit")
        choice = input("\nEnter choice: ")

        if choice == "1":
            add_expense()
        elif choice == "2":
            view_expenses()
        elif choice == "3":
            summary_by_category()
        elif choice == "4":
            summary_by_month()
        elif choice == "5":
            print("\nThank you for using Expense Tracker!\n")
            break
        else:
            print("\n⚠ Invalid choice. Try again.\n")

menu()
